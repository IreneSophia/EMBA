---
title: "Analysis FAB: Behavioural Data"
author: "Irene Sophia Plank"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)           # kable
library(tidyverse)       # tibble stuff
library(ggplot2)         # plots
library(ggstatsplot)     # ggplot with stats
library(ggrain)          # rainplots

fl.path = '/home/emba/Documents/EMBA'
dt.path = paste(fl.path, 'BVET', sep = "/")
knitr::opts_knit$set(root.dir = fl.path)

```

## R Markdown

<style type="text/css">
.main-container {
  max-width: 1100px;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r load_data, warning=F, message=F}
# load the relevant data in long format
df.tsk = list.files(path = dt.path, pattern = "FAB-BV_*", full.names = T) %>%
  setNames(nm = .) %>%
  map_df(~read_csv(., show_col_types = F, col_types = "cddddddddcd"), .id = "fln") %>% 
  mutate(subID = substr(fln, nchar(fln)-27, nchar(fln)-18),
         target = as.factor(target),
         target = recode(target, 
                "1" = "left",
                "2" = "right"),
         # sometimes participants used wrong row or caps was on
         choice = recode(key,
                "4" = "left",
                "LeftArrow" = "left", 
                "1" = "left", 
                "RightArrow" = "right", 
                "6" = "right", 
                "+" = "right"),
         acc = target == choice,
         cue = as.factor(congruent),
         cue = recode_factor(cue,
                "1" = "face",
                "0" = "object"),
         stm = if_else(left < right, paste(left, right, sep = "_"), paste(right, left, sep = "_"))) %>%
  select(subID, stm, rt, acc, cue, target) %>%
  filter(nchar(subID) == 10) %>% 
  # replace very short and very long RTs with NAs
  group_by(subID) %>%
  mutate(rt_up = quantile(rt, 0.75) + 1.5 * IQR(rt),
         rt    = case_when(rt > 200 & rt < rt_up ~ rt),
         use   = case_when(!is.na(rt) & acc ~ TRUE,
                           TRUE ~ FALSE),
         rt_cor = if_else(acc, rt, NA)
         ) %>% select(-rt_up)

df.tsk_acc = df.tsk %>%
  group_by(subID) %>%
  summarise(
    acc = mean(use)
  )

# does anyone have to be excluded?
exc = df.tsk_acc %>% filter(acc < 2/3)
exc = as.character(exc$subID)
print(length(exc)) # print how many have to be excluded

# load pilot participants and add to the list
pilot = read_csv(paste0(dt.path, "/pilot-subIDs.csv"))
exc   = c(exc, pilot$subID)

# exclude this participant
df.tsk = df.tsk %>% filter(!(subID %in% exc))

```

```{r plot_data, warning = F, message = F}

df.tsk_agg = df.tsk %>% filter(acc == TRUE) %>%
  group_by(subID, cue) %>%
  summarise(
    rt_agg = mean(rt, na.rm = T)
  )

nrow(df.tsk_agg)/2

ggwithinstats(data = df.tsk_agg, 
              x    = cue, 
              y    = rt_agg)

```
